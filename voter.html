<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Voter Panell</title>
  <!-- Google Fonts: Inter and Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&family=Poppins:wght@600&display=swap" rel="stylesheet" />
  <style>
    html, body {
      height: 100%; margin: 0; padding: 0; box-sizing: border-box;
      font-family: 'Inter', Arial, sans-serif;
      background: #e1e9f2;
      color: #23235b;
      min-height: 100vh;
      width: 100vw;
      overflow-x: hidden;
      transition: background-color 0.3s ease;
    }
    /* Header */
    .header {
      position: fixed; top: 0; left: 0;
      width: 100vw; height: 64px;
      background: #0d306c;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 1rem 0 3.5rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.27);
      z-index: 110; position: relative;
    }
    .header .title {
      position: absolute;
      left: 50%; transform: translateX(-50%);
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 1.7rem;
      color: #fff;
      background: #0d306c;
      padding: 8px 18px;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(74,44,153,0.25);
      user-select: none;
      pointer-events: none;
      text-shadow: 0 0 12px rgba(255,255,255,0.28);
    }
    /* Hamburger */
    .hamburger {
      position: fixed; top: 15px; left: 15px; width: 34px; height: 34px;
      background: linear-gradient(135deg, #3e52a1 0%, #5f6cff 100%);
      border-radius: 6px; cursor: pointer; z-index: 120;
      display: flex; flex-direction: column; justify-content: space-around;
      padding: 8px 6px;
      box-shadow: 0 4px 14px rgba(58,76,147,0.13);
      user-select: none; transition: background 0.3s ease;
    }
    .hamburger:hover { background: linear-gradient(135deg, #5f6cff 0%, #3e52a1 100%);}
    .hamburger div { width: 22px; height: 3px; background: #23235b; border-radius: 2px; transition: all 0.3s;}
    .hamburger.active div:nth-child(1) { transform: rotate(45deg) translate(5px,5px);}
    .hamburger.active div:nth-child(2) { opacity: 0;}
    .hamburger.active div:nth-child(3) { transform: rotate(-45deg) translate(6px,-6px);}
    
    /* Sidebar */
    .sidebar {
      position: fixed; top: 64px; left: 0; height: calc(100vh - 64px); width: 240px;
      background: linear-gradient(135deg, #e7ecfa 0%, #c6dafc 100%);
      box-shadow: 2px 0 20px rgba(18,24,83, .13);
      padding-top: 2rem;
      display: flex; flex-direction: column; align-items: center; gap: 1.65rem;
      transform: translateX(-260px);
      transition: transform 0.3s cubic-bezier(.4,0,.2,1);
      z-index: 105; user-select: none;
    }
    .sidebar.open { transform: translateX(0);}
    
    /* User name section in sidebar */
    .sidebar-user {
      width: 80%;
      margin-bottom: 1.2rem;
      text-align: center;
      color: #23235b;
      font-family: 'Poppins', sans-serif;
      font-size: 1.11rem;
      font-weight: 600;
      border-radius: 8px;
      background: #f0f2fd;
      padding: 0.65rem 0.4rem;
      box-shadow: 0 1px 6px #a8b6ff15;
      letter-spacing: 0.02em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .sidebar .nav-btn {
      background: none; border: none; color: #23235b;
      font-size: 1.08rem; font-weight: 600; cursor: pointer; outline: none;
      transition: color 0.22s, background 0.18s; display: flex; align-items: center;
      gap: 1rem; width: 80%; padding: 0.65rem 1rem;
      border-radius: 10px; user-select: none;
    }
    .sidebar .nav-btn:hover, .sidebar .nav-btn.active {
      color: #4a2c99; background: #f8faff; box-shadow: 0 0 10px #ececec22;
    }
    .sidebar .nav-btn svg {
      width: 22px; height: 22px; fill: #4a2c99; stroke: #4a2c99; transition: fill 0.2s;
    }
    .sidebar .nav-btn:hover svg, .sidebar .nav-btn.active svg { fill: #3e52a1; stroke: #3e52a1;}
    
    /* Overlay */
    .overlay {
      position: fixed; top: 64px; left: 0; width: 100vw;
      height: calc(100vh - 64px);
      background: rgba(0,0,0,.13); opacity: 0;
      pointer-events: none; transition: opacity 0.22s; z-index: 100;
    }
    .overlay.active { opacity: 1; pointer-events: auto;}
    
    /* Main */
    main {
      margin-top: 64px;
      padding: 2rem 1.5rem 3rem;
      max-width: 900px;
      margin-left: auto; margin-right: auto;
      color: #23235b;
      user-select: text;
      z-index: 10;
    }
    .hero { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; max-width: 640px; margin: 0 auto; padding: 0 1rem;}
    .hero h1 { font-size: 2.7rem; font-weight: 700; margin-bottom: 1rem; text-align: center; text-shadow: 0 3px 10px #c6dafc30; color: #23235b;}
    .hero p { font-size: 1.22rem; max-width: 520px; margin-bottom: 2.3rem; line-height: 1.58; text-align: center; color: #23235b;}
    .live-btn {
      display: inline-flex; margin: 0 auto; align-items: center; gap: 1rem;
      background: linear-gradient(90deg, #4a2c99 0%, #5f6cff 100%);
      color: #fff; font-weight: 600; font-size: 1.45rem; border: none;
      border-radius: 20px; padding: 1.18rem 4.5rem;
      box-shadow: 0 6px 19px rgba(107,123,168,0.22);
      cursor: pointer; letter-spacing: 0.07em;
      transition: background 0.25s, box-shadow 0.32s;
      user-select: none;
    }
    .live-btn svg { filter: drop-shadow(0 0 1px #1b356b7a);}
    .live-btn:hover {
      background: linear-gradient(90deg,#3e52a1 0%,#5f6cff 90%);
      box-shadow: 0 10px 28px rgba(94,91,220,0.14);
    }
    
    /* Modal Styles */
    .modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.23); align-items: center; justify-content: center;}
    .modal.show { display: flex; animation: fadeIn 0.12s;}
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; }}
    .modal-content { background: #fff; color: #23235b; padding: 2rem 2.5rem; border-radius: 16px; box-shadow: 0 8px 27px rgba(0,0,0,0.13); text-align: center; min-width: 250px; max-width: 91vw; animation: popIn 0.14s;}
    @keyframes popIn { from {transform: scale(.95); opacity:0;} to {transform:scale(1);opacity:1;}}
    .modal-content h2 { margin-top: 0; font-size: 1.35rem; margin-bottom: 0.7rem; color: #23235b;}
    .modal-content p { margin-bottom: 1.2rem; font-size: 1.1rem; color: #23235b;}
    .modal-actions { display: flex; justify-content: center; gap: 1.2rem;}
    .modal-btn { padding: 0.55rem 1.45rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background 0.12s;}
    .modal-btn.cancel { background: #e2e8ff; color: #23235b;}
    .modal-btn.cancel:hover { background: #bfc8e6;}
    .modal-btn.confirm { background: #ff4b5c; color: #fff;}
    .modal-btn.confirm:hover { background: #d7263d;}
    
    /* Responsive */
    @media (max-width: 760px) {
      main { max-width: 96vw; padding: 2rem 0.5rem 2.7rem; }
      .hero h1 { font-size: 2rem;}
      .hero p { font-size: 1.04rem;}
      .live-btn { font-size: 1.1rem; padding: 0.9rem 1.5rem;}
      .sidebar { width: 66vw; min-width: 190px;}
    }
    @media (max-width: 480px) {
      .sidebar { width: 95vw; min-width: 120px;}
      .header .title { font-size: 1.13rem; padding: 6px 10px; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="title">VOTEZY</div>
  </div>
  
  <!-- Hamburger Menu -->
  <div class="hamburger" id="hamburger" aria-label="Toggle sidebar menu" role="button" tabindex="0">
    <div></div><div></div><div></div>
  </div>
  
  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar" aria-label="Primary Navigation">
    <!-- User Name Display -->
    <div class="sidebar-user" id="sidebarUserName">Loading...</div>
    
    <button class="nav-btn active" title="Home" aria-current="page" onclick="window.location.href='home.html'">
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
      <span>Home</span>
    </button>
    <button class="nav-btn" title="Edit Profile" onclick="window.location.href='edit.html'">
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM21.71 6.04a1.003 1.003 0 0 0 0-1.41l-2.34-2.34a1.003 1.003 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
      <span>Edit</span>
    </button>
    <button class="nav-btn" title="History" onclick="window.location.href='history.html'">
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M12 7a2 2 0 1 1 0-4 2 2 0 0 1 0 4Zm0 2a6 6 0 0 0-6 6v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1v-1a6 6 0 0 0-6-6Z"/></svg>
      <span>History</span>
    </button>
    <button class="nav-btn" title="Notifications" onclick="window.location.href='notifications.html'">
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M18 17v-5a6 6 0 1 0-12 0v5l-2 2h16l-2-2Zm-6 5c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2Z"/></svg>
      <span>Notifications</span>
    </button>
    <button class="nav-btn" title="Upcoming Elections" onclick="window.location.href='upcoming-elections.html'">
      <svg width="22" height="22" fill="none" stroke="#a8b6ffcc" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2v20M2 12h20" /></svg>
      <span>Upcoming Elections</span>
    </button>
    <button class="nav-btn" title="Next Voting Deadline" onclick="window.location.href='voting-deadline.html'">
      <svg width="22" height="22" fill="none" stroke="#a8b6ffcc" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
      <span>Next Voting Deadline</span>
    </button>
    <button class="nav-btn" title="Profile Status" onclick="window.location.href='profile-status.html'">
      <svg width="22" height="22" fill="none" stroke="#a8b6ffcc" stroke-width="2" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-8 0v2"/><circle cx="12" cy="7" r="4"/></svg>
      <span>Profile Status</span>
    </button>
    <button class="nav-btn" title="Log Out" onclick="confirmLogout()">
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M16 13v-2H7V8l-5 4 5 4v-3h9z"/><path d="M17 3h4a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1h-4"/></svg>
      <span>Log Out</span>
    </button>
  </nav>
  
  <!-- Overlay -->
  <div id="overlay" class="overlay"></div>
  
  <!-- Main Content -->
  <main>
    <section class="hero">
      <h1>Welcome to the Voter Panel</h1>
      <p>
        Easily participate in elections, view your history, and explore updates.<br />
        Click the button below to access the current live election.
      </p>
      <button class="live-btn" onclick="window.location.href='live-election.html'">
        <svg width="26" height="26" viewBox="0 0 28 28" aria-hidden="true" focusable="false">
          <circle cx="14" cy="14" r="7" fill="#fff" opacity="0.12" />
          <circle cx="14" cy="14" r="5.6" fill="none" stroke="#fff" stroke-width="1.5" />
          <circle cx="14" cy="14" r="2.2" fill="#fff" />
          <circle cx="14" cy="14" r="1.1" fill="#23b6e0" />
        </svg>
        Live Election
      </button>
    </section>
  </main>
  
  <!-- Logout Confirmation Modal -->
  <div id="logoutModal" class="modal">
    <div class="modal-content">
      <h2>Log Out</h2>
      <p>Are you sure you want to log out?</p>
      <div class="modal-actions">
        <button id="logoutCancel" class="modal-btn cancel">Cancel</button>
        <button id="logoutConfirm" class="modal-btn confirm">Log Out</button>
      </div>
    </div>
  </div>
  
  <script>
    // Sidebar/hamburger logic
    const hamburger = document.getElementById('hamburger');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    
    function toggleSidebar() {
      hamburger.classList.toggle('active'); 
      sidebar.classList.toggle('open'); 
      overlay.classList.toggle('active');
    }
    
    hamburger.addEventListener('click', toggleSidebar);
    hamburger.addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' ') { 
        e.preventDefault(); 
        toggleSidebar(); 
      }
    });
    overlay.addEventListener('click', toggleSidebar);
    
    // Modal logic
    function confirmLogout() {
      document.getElementById('logoutModal').classList.add('show');
    }
    document.getElementById('logoutCancel').onclick = function() {
      document.getElementById('logoutModal').classList.remove('show');
    };
    document.getElementById('logoutConfirm').onclick = function() {
      // Clear any stored tokens/session data
      localStorage.removeItem('authToken');
      sessionStorage.clear();
      window.location.href = 'login.html';
    };
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        document.getElementById('logoutModal').classList.remove('show');
      }
    });
    
    // Fetch user name from backend and display in sidebar
    window.addEventListener("DOMContentLoaded", async function() {
      try {
        // Option 1: If using JWT token stored in localStorage
        const token = localStorage.getItem('authToken'); 
        
        // Option 2: If using session cookies, use credentials: 'include' instead
        const res = await fetch("http://localhost:8080/api/user/me", {
          headers: { 
            "Authorization": token ? "Bearer " + token : undefined,
            "Content-Type": "application/json"
          },
          // credentials: "include" // Uncomment if using cookies instead of JWT
        }); 
        
        if (!res.ok) {
          throw new Error("Unauthorized or failed to fetch user data");
        }
        
        const user = await res.json();
        
        // Display user name in sidebar
        const userName = user.name || user.fullName || "User";
        document.getElementById("sidebarUserName").textContent = "ðŸ‘‹ " + userName;
        
      } catch (error) {
        console.error("Failed to fetch user data:", error);
        document.getElementById("sidebarUserName").textContent = "ðŸ‘‹ Welcome!";
        
        // Optional: Redirect to login if user is not authenticated
        // if (error.message.includes("Unauthorized")) {
        //   window.location.href = 'login.html';
        // }
      }
    });
  </script>
</body>
</html>
